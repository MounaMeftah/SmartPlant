<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>ğŸŒ¿</text></svg>">
    <title>SmartPlant - SystÃ¨me de Surveillance Intelligent</title>
    
    <!-- Styles CSS -->
    <link rel="stylesheet" href="style.css">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- TensorFlow.js & Teachable Machine -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@1.7.4/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8.4/dist/teachablemachine-image.min.js"></script>
    
    <!-- ğŸ“§ EmailJS SDK - Notifications par Email -->
    <script type="text/javascript" src="https://cdn.emailjs.com/sdk/3.2.0/email.min.js"></script>
</head>
<body>
    <!-- ============================================
         SIDEBAR NAVIGATION
         ============================================ -->
    <div class="sidebar">
        <div class="logo">
            <span>ğŸŒ¿</span>
            <span>SmartPlant</span>
        </div>
        
        <div class="nav-item active" onclick="showPage('home')">
            <span class="nav-icon">ğŸ </span>
            <span>Accueil</span>
        </div>
        
        <div class="nav-item" onclick="showPage('analyse')">
            <span class="nav-icon">ğŸ“Š</span>
            <span>Analyse</span>
        </div>
        
        <div class="nav-item" onclick="showPage('watering')">
            <span class="nav-icon">ğŸ’§</span>
            <span>Arrosage</span>
        </div>
        
        <div class="nav-item" onclick="showPage('plants')">
            <span class="nav-icon">ğŸŒ±</span>
            <span>Mes Plantes</span>
        </div>
        
        <div class="nav-item" onclick="showPage('health')">
            <span class="nav-icon">ğŸ¥</span>
            <span>SantÃ©</span>
        </div>
        
        <div class="nav-item" onclick="showPage('configuration')">
            <span class="nav-icon">âš™ï¸</span>
            <span>Configuration</span>
        </div>
    </div>

    <!-- ============================================
         MAIN CONTENT AREA
         ============================================ -->
    <div class="main-content">
        
        <!-- ========================================
             PAGE 1: ACCUEIL
             ======================================== -->
        <div id="home" class="page active">
            <div class="page-header">
                <h1 class="page-title">Dashboard</h1>
                <p class="page-subtitle">Vue d'ensemble de votre jardin intelligent</p>
            </div>

            <!-- Cartes Capteurs -->
            <div class="cards-grid">
                <div class="card">
                    <div class="card-header">
                        <div>
                            <div class="card-title">ğŸ’¨ HumiditÃ© Air</div>
                            <div class="card-value" id="homeHumiditeAir">--</div>
                            <div class="card-label" id="homeHumiditeAirStatus">Chargement...</div>
                        </div>
                        <div class="card-icon">ğŸ’¨</div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <div>
                            <div class="card-title">ğŸ’§ HumiditÃ© Sol</div>
                            <div class="card-value" id="homeHumiditeSol">--</div>
                            <div class="card-label" id="homeHumiditeSolStatus">Chargement...</div>
                        </div>
                        <div class="card-icon">ğŸ’§</div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <div>
                            <div class="card-title">ğŸŒ¡ï¸ TempÃ©rature</div>
                            <div class="card-value" id="homeTemperature">--</div>
                            <div class="card-label" id="homeTemperatureStatus">Chargement...</div>
                        </div>
                        <div class="card-icon">ğŸŒ¡ï¸</div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <div>
                            <div class="card-title">ğŸŒ§ï¸ Pluie</div>
                            <div class="card-value" id="homePluie">--</div>
                            <div class="card-label" id="homePluieStatus">DÃ©tection...</div>
                        </div>
                        <div class="card-icon">ğŸŒ§ï¸</div>
                    </div>
                </div>
            </div>

            <!-- Widget MÃ©tÃ©o -->
            <div class="weather-widget">
                <h3 style="margin-bottom: 15px;">â˜€ï¸ Chargement mÃ©tÃ©o...</h3>
                <div style="text-align: center;">
                    <div class="loading-spinner"></div>
                </div>
            </div>

            <!-- Alertes -->
            <h2 style="margin-bottom: 20px;">ğŸ”” Alertes RÃ©centes</h2>
            <div id="alertsContainer">
                <div class="alert alert-info">
                    <span style="font-size: 24px;">â„¹ï¸</span>
                    <div>
                        <strong>SystÃ¨me OpÃ©rationnel</strong>
                        <p style="margin-top: 5px; color: var(--text-secondary);">
                            Surveillance active. DÃ©tection IA en continu.
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- ========================================
             PAGE 2: ANALYSE
             ======================================== -->
        <div id="analyse" class="page">
            <div class="page-header">
                <h1 class="page-title">ğŸ“Š Analyse & Monitoring</h1>
                <p class="page-subtitle">Surveillance environnementale en temps rÃ©el</p>
            </div>

            <!-- Filtres temporels -->
            <div style="margin-bottom: 30px; display: flex; gap: 10px; flex-wrap: wrap;">
                <button class="btn btn-secondary" onclick="changeTimeRange('realtime')">Temps RÃ©el</button>
                <button class="btn btn-secondary" onclick="changeTimeRange('week')">7 Jours</button>
                <button class="btn btn-secondary" onclick="changeTimeRange('month')">30 Jours</button>
            </div>

            <!-- Capteurs -->
            <h2 style="margin: 30px 0 20px;">ğŸ“¡ Capteurs Environnementaux</h2>
            <div class="cards-grid">
                <div class="card">
                    <div class="card-title">ğŸ’§ HumiditÃ© Sol</div>
                    <div class="card-value" id="analyseHumiditeSol">--</div>
                    <div class="status-badge status-info">Chargement...</div>
                </div>
                <div class="card">
                    <div class="card-title">ğŸŒ¡ï¸ TempÃ©rature</div>
                    <div class="card-value" id="analyseTemperature">--</div>
                    <div class="status-badge status-info">Chargement...</div>
                </div>
                <div class="card">
                    <div class="card-title">ğŸ’¨ HumiditÃ© Air</div>
                    <div class="card-value" id="analyseHumiditeAir">--</div>
                    <div class="status-badge status-info">Chargement...</div>
                </div>
                <div class="card">
                    <div class="card-title">ğŸŒ§ï¸ Pluie</div>
                    <div class="card-value" id="analysePluie">--</div>
                    <div class="card-label">DÃ©tection</div>
                </div>
            </div>

            <!-- Graphiques -->
            <h2 style="margin: 40px 0 20px;">ğŸ“ˆ Ã‰volution Temps RÃ©el</h2>
            
            <div class="chart-container">
                <h3 style="margin-bottom: 20px;">ğŸ’§ HumiditÃ© du Sol</h3>
                <div class="chart-wrapper">
                    <canvas id="moistureChart"></canvas>
                </div>
            </div>

            <div class="chart-container">
                <h3 style="margin-bottom: 20px;">ğŸŒ¡ï¸ TempÃ©rature et HumiditÃ© Air</h3>
                <div class="chart-wrapper">
                    <canvas id="tempChart"></canvas>
                </div>
            </div>

            <!-- Statistiques -->
            <h2 style="margin: 40px 0 20px;">ğŸ“Š Statistiques</h2>
            <div class="cards-grid">
                <div class="card">
                    <div class="card-title">ğŸŒ± Score SantÃ©</div>
                    <div class="card-value" id="avgHealth">--</div>
                    <div id="healthTrend">Calcul...</div>
                </div>
                <div class="card">
                    <div class="card-title">ğŸ©º Diagnostics IA</div>
                    <div class="card-value">23</div>
                    <div style="color: var(--text-secondary);">Ce mois</div>
                </div>
                <div class="card">
                    <div class="card-title">ğŸ’Š Taux RÃ©ussite</div>
                    <div class="card-value">92%</div>
                    <div style="color: var(--success);">Traitements</div>
                </div>
                <div class="card">
                    <div class="card-title">â±ï¸ Temps RÃ©ponse</div>
                    <div class="card-value">1.2h</div>
                    <div style="color: var(--success);">Moyenne</div>
                </div>
            </div>

            <!-- Graphique SantÃ© -->
            <div class="chart-container">
                <h3 style="margin-bottom: 20px;">ğŸ“Š Ã‰volution SantÃ© Globale</h3>
                <div class="chart-wrapper">
                    <canvas id="healthChart"></canvas>
                </div>
            </div>
        </div>

        <!-- ========================================
             PAGE 3: ARROSAGE
             ======================================== -->
        <div id="watering" class="page">
            <div class="page-header">
                <h1 class="page-title">ğŸ’§ Gestion Arrosage</h1>
                <p class="page-subtitle">3 modes : Automatique, Manuel, ProgrammÃ©</p>
            </div>

            <!-- SÃ©lection Mode -->
            <div class="card" style="background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(5, 150, 105, 0.05) 100%);">
                <h3 style="margin-bottom: 20px;">ğŸ® Mode d'Arrosage</h3>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 15px; margin-bottom: 25px;">
                    <div class="mode-card" id="modeAutoCard" onclick="setWateringMode('automatique')">
                        <div style="font-size: 48px; margin-bottom: 10px;">ğŸ¤–</div>
                        <h4>Automatique</h4>
                        <p style="color: var(--text-secondary); font-size: 14px; margin-top: 8px;">
                            BasÃ© sur humiditÃ©
                        </p>
                        <div class="mode-indicator" id="modeAutoIndicator">
                            <span class="status-badge status-success">âœ… Actif</span>
                        </div>
                    </div>

                    <div class="mode-card" id="modeManuelCard" onclick="setWateringMode('manuel')">
                        <div style="font-size: 48px; margin-bottom: 10px;">ğŸ‘†</div>
                        <h4>Manuel</h4>
                        <p style="color: var(--text-secondary); font-size: 14px; margin-top: 8px;">
                            ContrÃ´le direct
                        </p>
                        <div class="mode-indicator" id="modeManuelIndicator">
                            <span class="status-badge status-info">Disponible</span>
                        </div>
                    </div>

                    <div class="mode-card" id="modeProgrammeCard" onclick="setWateringMode('programme')">
                        <div style="font-size: 48px; margin-bottom: 10px;">â°</div>
                        <h4>ProgrammÃ©</h4>
                        <p style="color: var(--text-secondary); font-size: 14px; margin-top: 8px;">
                            Horaires fixes
                        </p>
                        <div class="mode-indicator" id="modeProgrammeIndicator">
                            <span class="status-badge status-info">Disponible</span>
                        </div>
                    </div>
                </div>

                <!-- Statut -->
                <div style="padding: 15px; background: rgba(255,255,255,0.05); border-radius: 10px;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <strong id="currentModeText">Mode: Automatique</strong>
                            <p style="color: var(--text-secondary); font-size: 14px; margin-top: 5px;" id="currentModeDescription">
                                Arrosage auto si humiditÃ© < 30%
                            </p>
                        </div>
                        <div id="pumpStatusBadge">
                            <span class="status-badge status-info">â¸ï¸ En Attente</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Panneau Automatique -->
            <div class="card" id="panelAutomatic">
                <h3 style="margin-bottom: 20px;">ğŸ¤– Configuration Automatique</h3>
                
                <div class="input-group">
                    <label class="input-label">ğŸŒ± Seuil Minimum (%)</label>
                    <input type="number" class="input-field" id="autoSeuilMin" value="30" min="0" max="100">
                </div>

                <div class="input-group">
                    <label class="input-label">ğŸ’§ DurÃ©e (secondes)</label>
                    <input type="number" class="input-field" id="autoDuree" value="5" min="1" max="60">
                </div>

                <div class="input-group">
                    <label class="input-label">â±ï¸ DÃ©lai Min (minutes)</label>
                    <input type="number" class="input-field" id="autoDelai" value="60" min="10" max="1440">
                </div>

                <button class="btn btn-primary" onclick="saveAutomaticConfig()">ğŸ’¾ Sauvegarder</button>
            </div>

            <!-- Panneau Manuel -->
            <div class="card" id="panelManual" style="display: none;">
                <h3 style="margin-bottom: 20px;">ğŸ‘† ContrÃ´le Manuel</h3>

                <div style="text-align: center; padding: 40px 20px;">
                    <div style="font-size: 80px; margin-bottom: 20px;" id="pumpIcon">ğŸ’§</div>
                    <h2 style="margin-bottom: 15px;" id="pumpStatusText">Pompe DÃ©sactivÃ©e</h2>
                    
                    <div style="margin: 30px 0;">
                        <button class="btn-pump" id="btnTogglePump" onclick="toggleManualPump()">
                            <span style="font-size: 24px;">â–¶ï¸</span>
                            <span>DÃ©marrer</span>
                        </button>
                    </div>

                    <p style="color: var(--text-secondary); margin-top: 20px;">
                        DurÃ©e : <strong id="manualDurationDisplay">5s</strong>
                    </p>
                </div>

                <div class="input-group">
                    <label class="input-label">ğŸ’§ DurÃ©e (secondes)</label>
                    <input type="number" class="input-field" id="manualDuree" value="5" min="1" max="60" onchange="updateManualDuration()">
                </div>
            </div>

            <!-- Panneau ProgrammÃ© -->
            <div class="card" id="panelScheduled" style="display: none;">
                <h3 style="margin-bottom: 20px;">â° Programmation</h3>

                <div class="schedule-item">
                    <h4 style="margin-bottom: 15px;">Programme 1</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                        <div class="input-group">
                            <label class="input-label">Heure</label>
                            <input type="number" class="input-field" id="prog1Heure" value="7" min="0" max="23">
                        </div>
                        <div class="input-group">
                            <label class="input-label">Minute</label>
                            <input type="number" class="input-field" id="prog1Minute" value="0" min="0" max="59">
                        </div>
                        <div class="input-group">
                            <label class="input-label">DurÃ©e (s)</label>
                            <input type="number" class="input-field" id="prog1Duree" value="5" min="1" max="60">
                        </div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <label>Actif</label>
                        <div class="toggle-switch active" id="prog1Toggle" onclick="this.classList.toggle('active')">
                            <div class="toggle-slider"></div>
                        </div>
                    </div>
                </div>

                <div class="schedule-item" style="margin-top: 20px;">
                    <h4 style="margin-bottom: 15px;">Programme 2</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                        <div class="input-group">
                            <label class="input-label">Heure</label>
                            <input type="number" class="input-field" id="prog2Heure" value="18" min="0" max="23">
                        </div>
                        <div class="input-group">
                            <label class="input-label">Minute</label>
                            <input type="number" class="input-field" id="prog2Minute" value="0" min="0" max="59">
                        </div>
                        <div class="input-group">
                            <label class="input-label">DurÃ©e (s)</label>
                            <input type="number" class="input-field" id="prog2Duree" value="5" min="1" max="60">
                        </div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <label>Actif</label>
                        <div class="toggle-switch" id="prog2Toggle" onclick="this.classList.toggle('active')">
                            <div class="toggle-slider"></div>
                        </div>
                    </div>
                </div>

                <button class="btn btn-primary" onclick="saveScheduledConfig()" style="margin-top: 25px;">ğŸ’¾ Sauvegarder</button>
            </div>

            <!-- Statistiques -->
            <h2 style="margin: 40px 0 20px;">ğŸ“Š Statistiques</h2>
            <div class="cards-grid">
                <div class="card">
                    <div class="card-title">ğŸ’§ Aujourd'hui</div>
                    <div class="card-value" id="waterToday">0L</div>
                    <div class="card-label" id="waterTodayCount">0 arrosages</div>
                </div>
                <div class="card">
                    <div class="card-title">ğŸ“… Semaine</div>
                    <div class="card-value" id="waterWeek">0L</div>
                    <div class="card-label">Cette semaine</div>
                </div>
                <div class="card">
                    <div class="card-title">ğŸ“Š Mois</div>
                    <div class="card-value" id="waterMonth">0L</div>
                    <div class="card-label">Ce mois</div>
                </div>
                <div class="card">
                    <div class="card-title">â±ï¸ DurÃ©e Moy</div>
                    <div class="card-value" id="waterAvgDuration">0s</div>
                    <div class="card-label">Par arrosage</div>
                </div>
            </div>

            <!-- Historique -->
            <div class="card">
                <h3 style="margin-bottom: 20px;">ğŸ“œ Historique</h3>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Date & Heure</th>
                            <th>Mode</th>
                            <th>DurÃ©e</th>
                            <th>HumiditÃ© Avant</th>
                            <th>Statut</th>
                        </tr>
                    </thead>
                    <tbody id="wateringHistory">
                        <tr>
                            <td colspan="5" style="text-align: center;">Chargement...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- ========================================
             PAGE 4: MES PLANTES
             ======================================== -->
        <div id="plants" class="page">
            <div class="page-header">
                <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px;">
                    <div>
                        <h1 class="page-title">ğŸ… Mes Plants de Tomates</h1>
                        <p class="page-subtitle">Gestion de votre culture</p>
                    </div>
                    <button class="btn btn-primary" onclick="showAddPlantModal()">
                        <span style="font-size: 18px;">â•</span>
                        <span>Ajouter Plant</span>
                    </button>
                </div>
            </div>

            <!-- Vue d'ensemble -->
            <div class="cards-grid" style="margin-bottom: 30px;">
                <div class="card">
                    <div class="card-header">
                        <div>
                            <div class="card-title">ğŸŒ± Total</div>
                            <div class="card-value" id="totalPlants">0</div>
                            <div class="card-label">Plants actifs</div>
                        </div>
                        <div class="card-icon">ğŸŒ±</div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header">
                        <div>
                            <div class="card-title">âœ… SantÃ©</div>
                            <div class="card-value" id="healthyPlants">0</div>
                            <div class="card-label">En bonne santÃ©</div>
                        </div>
                        <div class="card-icon">ğŸ©º</div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header">
                        <div>
                            <div class="card-title">âš ï¸ Attention</div>
                            <div class="card-value" id="warningPlants">0</div>
                            <div class="card-label">NÃ©cessitent soins</div>
                        </div>
                        <div class="card-icon">ğŸš¨</div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header">
                        <div>
                            <div class="card-title">ğŸ“… Ã‚ge Moyen</div>
                            <div class="card-value" id="avgAge">0j</div>
                            <div class="card-label">Depuis plantation</div>
                        </div>
                        <div class="card-icon">ğŸ“†</div>
                    </div>
                </div>
            </div>

            <!-- Conditions -->
            <div class="card" style="margin-bottom: 30px; background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(5, 150, 105, 0.05) 100%);">
                <h3 style="margin-bottom: 20px;">ğŸŒ Conditions Actuelles</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                    <div style="text-align: center; padding: 15px; background: rgba(255,255,255,0.05); border-radius: 12px;">
                        <div style="font-size: 36px;">ğŸ’§</div>
                        <div style="font-size: 24px; font-weight: bold; color: var(--primary);" id="envHumiditeSol">--</div>
                        <div style="color: var(--text-secondary);">HumiditÃ© Sol</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: rgba(255,255,255,0.05); border-radius: 12px;">
                        <div style="font-size: 36px;">ğŸŒ¡ï¸</div>
                        <div style="font-size: 24px; font-weight: bold;" id="envTemperature">--</div>
                        <div style="color: var(--text-secondary);">TempÃ©rature</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: rgba(255,255,255,0.05); border-radius: 12px;">
                        <div style="font-size: 36px;">ğŸ’¨</div>
                        <div style="font-size: 24px; font-weight: bold;" id="envHumiditeAir">--</div>
                        <div style="color: var(--text-secondary);">HumiditÃ© Air</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: rgba(255,255,255,0.05); border-radius: 12px;">
                        <div style="font-size: 36px;">ğŸŒ§ï¸</div>
                        <div style="font-size: 24px; font-weight: bold;" id="envPluie">--</div>
                        <div style="color: var(--text-secondary);">Pluie</div>
                    </div>
                </div>
            </div>

            <!-- Filtres -->
            <div style="display: flex; gap: 15px; margin-bottom: 25px; flex-wrap: wrap;">
                <select id="filterPlants" class="input-field" style="width: auto;" onchange="filterPlants()">
                    <option value="all">Tous les plants</option>
                    <option value="healthy">En bonne santÃ©</option>
                    <option value="warning">Attention</option>
                    <option value="disease">Maladie</option>
                </select>
                <select id="sortPlants" class="input-field" style="width: auto;" onchange="sortPlants()">
                    <option value="name">Nom</option>
                    <option value="age">Ã‚ge</option>
                    <option value="health">SantÃ©</option>
                    <option value="lastWatered">Dernier arrosage</option>
                </select>
            </div>

            <!-- Liste Plants -->
            <div id="plantsContainer"></div>

            <!-- Message vide -->
            <div id="noPlantsMessage" style="display: none;">
                <div class="card" style="text-align: center; padding: 60px 20px;">
                    <div style="font-size: 80px;">ğŸ…</div>
                    <h3 style="margin-bottom: 15px;">Aucun plant</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 25px;">
                        Commencez Ã  enregistrer vos plants
                    </p>
                    <button class="btn btn-primary" onclick="showAddPlantModal()">
                        â• Ajouter plant
                    </button>
                </div>
            </div>
        </div>

        <!-- ========================================
             PAGE 5: SANTÃ‰ DES PLANTES
             ======================================== -->
        <div id="health" class="page">
            <div class="page-header">
                <h1 class="page-title">ğŸ¥ SantÃ© des Plantes</h1>
                <p class="page-subtitle">DÃ©tection des maladies par intelligence artificielle</p>
            </div>

            <!-- Zone d'upload -->
            <div class="upload-section">
                <div class="upload-area" id="healthUploadArea">
                    <div class="upload-icon">ğŸ“¸</div>
                    <div class="upload-text">Cliquez ou glissez une photo de votre plante</div>
                    <div class="upload-hint">Formats supportÃ©s: JPG, PNG, JPEG</div>
                    <input type="file" id="healthFileInput" accept="image/*" style="display: none;">
                </div>
            </div>

            <!-- AperÃ§u de l'image -->
            <div id="healthPreviewContainer" class="preview-section" style="display: none;">
                <h2 style="margin-bottom: 20px;">ğŸ“· AperÃ§u</h2>
                <div class="image-preview-card">
                    <img id="healthImagePreview" class="preview-image" alt="AperÃ§u">
                    <button class="btn btn-primary btn-large" id="healthAnalyzeBtn">
                        <span style="font-size: 24px;">ğŸ”</span>
                        <span>Analyser la plante</span>
                    </button>
                </div>
            </div>

            <!-- Zone de chargement -->
            <div id="healthLoading" class="loading-section" style="display: none;">
                <div class="loading-spinner"></div>
                <p style="margin-top: 20px; font-size: 18px;">ğŸ”¬ Analyse en cours...</p>
                <p style="color: var(--text-secondary); margin-top: 10px;">L'IA examine votre plante</p>
            </div>

            <!-- RÃ©sultats -->
            <div id="healthResultsContainer" class="results-section" style="display: none;">
                <h2 style="margin-bottom: 20px;">ğŸ“Š RÃ©sultats de l'analyse</h2>
                <div id="healthResultsContent"></div>
            </div>

            <!-- Historique des analyses -->
            <div class="history-section">
                <h2 style="margin-bottom: 20px;">ğŸ“œ Historique des Analyses</h2>
                <div id="healthHistory" class="history-grid">
                    <div class="alert alert-info">
                        <span style="font-size: 24px;">â„¹ï¸</span>
                        <div>
                            <strong>Aucune analyse</strong>
                            <p style="margin-top: 5px; color: var(--text-secondary);">
                                Commencez par tÃ©lÃ©charger une photo de votre plante
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ========================================
             PAGE 6: CONFIGURATION
             ======================================== -->
        <div id="configuration" class="page">
            <div class="page-header">
                <h1 class="page-title">âš™ï¸ Configuration</h1>
                <p class="page-subtitle">ParamÃ¨tres du systÃ¨me</p>
            </div>

            <!-- ParamÃ¨tres Arrosage -->
            <div class="card" style="margin-bottom: 30px;">
                <h2 style="margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                    <span style="font-size: 32px;">ğŸ’§</span>
                    ParamÃ¨tres d'Arrosage
                </h2>

                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 25px;">
                    <div class="form-group">
                        <label for="seuilMin">
                            <span style="font-size: 18px; margin-right: 8px;">ğŸ“‰</span>
                            Seuil Minimum (%)
                        </label>
                        <input type="number" class="input-field" id="seuilMin" value="30" min="0" max="100">
                        <small style="color: var(--text-secondary); display: block; margin-top: 8px;">
                            DÃ©clenche l'arrosage automatique
                        </small>
                    </div>

                    <div class="form-group">
                        <label for="seuilMax">
                            <span style="font-size: 18px; margin-right: 8px;">ğŸ“ˆ</span>
                            Seuil Maximum (%)
                        </label>
                        <input type="number" class="input-field" id="seuilMax" value="70" min="0" max="100">
                        <small style="color: var(--text-secondary); display: block; margin-top: 8px;">
                            Alerte si trop d'eau
                        </small>
                    </div>

                    <div class="form-group">
                        <label for="tempMax">
                            <span style="font-size: 18px; margin-right: 8px;">ğŸŒ¡ï¸</span>
                            TempÃ©rature Max (Â°C)
                        </label>
                        <input type="number" class="input-field" id="tempMax" value="35" min="0" max="50">
                        <small style="color: var(--text-secondary); display: block; margin-top: 8px;">
                            Alerte tempÃ©rature haute
                        </small>
                    </div>
                </div>

                <div style="margin-top: 25px;">
                    <button class="btn btn-primary" onclick="saveThresholds()">
                        ğŸ’¾ Enregistrer les Seuils
                    </button>
                </div>
            </div>

            <!-- Notifications Email -->
            <div class="card" style="margin-bottom: 30px; border: 2px solid var(--primary);">
                <h2 style="margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                    <span style="font-size: 32px;">ğŸ“§</span>
                    Notifications par Email
                </h2>

                <div class="alert alert-info" style="margin-bottom: 20px;">
                    <span style="font-size: 24px;">â„¹ï¸</span>
                    <div>
                        <strong>SystÃ¨me de Notifications Actif</strong>
                        <p style="margin-top: 5px; color: var(--text-secondary);">
                            Vous recevrez des emails pour les alertes critiques (sol sec, tempÃ©rature extrÃªme, maladies)
                        </p>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-bottom: 20px;">
                    <div style="padding: 15px; background: rgba(16, 185, 129, 0.1); border-radius: 8px; border-left: 4px solid var(--success);">
                        <div style="font-size: 24px; margin-bottom: 8px;">ğŸš¨</div>
                        <strong>Sol Critique</strong>
                        <p style="font-size: 13px; color: var(--text-secondary); margin-top: 5px;">
                            Alerte si humiditÃ© < 20%
                        </p>
                    </div>
                    <div style="padding: 15px; background: rgba(245, 158, 11, 0.1); border-radius: 8px; border-left: 4px solid var(--warning);">
                        <div style="font-size: 24px; margin-bottom: 8px;">âš ï¸</div>
                        <strong>Sol Sec</strong>
                        <p style="font-size: 13px; color: var(--text-secondary); margin-top: 5px;">
                            Alerte si humiditÃ© < seuil min
                        </p>
                    </div>
                    <div style="padding: 15px; background: rgba(245, 158, 11, 0.1); border-radius: 8px; border-left: 4px solid var(--warning);">
                        <div style="font-size: 24px; margin-bottom: 8px;">ğŸŒ¡ï¸</div>
                        <strong>TempÃ©rature</strong>
                        <p style="font-size: 13px; color: var(--text-secondary); margin-top: 5px;">
                            Alerte si < 10Â°C ou > 35Â°C
                        </p>
                    </div>
                    <div style="padding: 15px; background: rgba(239, 68, 68, 0.1); border-radius: 8px; border-left: 4px solid var(--danger);">
                        <div style="font-size: 24px; margin-bottom: 8px;">ğŸ©º</div>
                        <strong>Maladie</strong>
                        <p style="font-size: 13px; color: var(--text-secondary); margin-top: 5px;">
                            Alerte si maladie dÃ©tectÃ©e
                        </p>
                    </div>
                </div>

                <p style="font-size: 13px; color: var(--text-secondary);">
                    ğŸ’¡ <strong>Note:</strong> Les emails sont envoyÃ©s avec un dÃ©lai minimum de 30 minutes entre chaque notification du mÃªme type pour Ã©viter le spam.
                </p>
            </div>

            <!-- Export DonnÃ©es -->
            <div class="card">
                <h2 style="margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                    <span style="font-size: 32px;">ğŸ“¥</span>
                    Export des DonnÃ©es
                </h2>

                <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                    <button class="btn btn-secondary" onclick="exportData('csv')">
                        ğŸ“„ Export CSV
                    </button>
                    <button class="btn btn-secondary" onclick="exportData('json')">
                        ğŸ“Š Export JSON
                    </button>
                    <button class="btn btn-secondary" onclick="exportData('pdf')">
                        ğŸ“‘ Export PDF
                    </button>
                </div>
            </div>
        </div>

    </div>

    <!-- ============================================
         MODALS
         ============================================ -->
    
    <!-- Modal Ajout Plant -->
    <div id="plantModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                <h2 id="modalTitle">â• Ajouter un Plant</h2>
                <button class="btn-close" onclick="closePlantModal()">âœ–ï¸</button>
            </div>

            <div class="input-group">
                <label class="input-label">ğŸ·ï¸ Nom</label>
                <input type="text" id="plantName" class="input-field" placeholder="Ex: Tomate CÅ“ur de BÅ“uf #1">
            </div>

            <div class="input-group">
                <label class="input-label">ğŸ… VariÃ©tÃ©</label>
                <select id="plantVariety" class="input-field">
                    <option value="CÅ“ur de BÅ“uf">CÅ“ur de BÅ“uf</option>
                    <option value="Roma">Roma</option>
                    <option value="Cherry">Cherry</option>
                    <option value="Beefsteak">Beefsteak</option>
                    <option value="San Marzano">San Marzano</option>
                    <option value="Autre">Autre</option>
                </select>
            </div>

            <div class="input-group">
                <label class="input-label">ğŸ“… Date Plantation</label>
                <input type="date" id="plantDate" class="input-field">
            </div>

            <div class="input-group">
                <label class="input-label">ğŸ“ Emplacement</label>
                <input type="text" id="plantLocation" class="input-field" placeholder="Ex: Potager Zone A">
            </div>

            <div class="input-group">
                <label class="input-label">ğŸ“ Notes</label>
                <textarea id="plantNotes" class="input-field" rows="3" placeholder="Observations..."></textarea>
            </div>

            <div style="display: flex; gap: 15px; margin-top: 30px;">
                <button class="btn btn-primary" onclick="savePlant()" style="flex: 1;">ğŸ’¾ Enregistrer</button>
                <button class="btn btn-secondary" onclick="closePlantModal()" style="flex: 1;">âŒ Annuler</button>
            </div>
        </div>
    </div>

    <!-- ============================================
         SCRIPTS - ORDRE IMPORTANT
         ============================================ -->
    
    <!-- 1. Configuration EmailJS (CHARGER EN PREMIER) -->
    <script src="emailjs-config.js"></script>
    
    <!-- 2. Configuration gÃ©nÃ©rale -->
    <script src="config.js"></script>
    
    <!-- 3. Script principal avec notifications email -->
    <script src="script.js"></script>
    
    <!-- 4. Modules additionnels -->
    <script src="plants-module.js"></script>
    <script src="configuration-module.js"></script>
    <script src="health-module.js"></script>
</body>
</html>